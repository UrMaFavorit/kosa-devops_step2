Q. ì´ YAML íŒŒì¼ì˜ ì—­í• ì€?
GitHub Actionsë¥¼ ì´ìš©í•´
Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìë™ìœ¼ë¡œ ë¹Œë“œí•˜ê³ 
Docker ì´ë¯¸ì§€ë¡œ ë§Œë“¤ì–´ ë°°í¬í•˜ëŠ” CI/CD íŒŒì´í”„ë¼ì¸ì´ë‹¤

# ============================================================
# GitHub Actions ì›Œí¬í”Œë¡œìš° ì´ë¦„
# - GitHub Actions í™”ë©´ì— í‘œì‹œë˜ëŠ” íŒŒì´í”„ë¼ì¸ ì´ë¦„
# ============================================================
name: Spring boot docker image CI/CD

# ============================================================
# ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì¡°ê±´
# - main ë¸Œëœì¹˜ì— push ë  ë•Œë§ˆë‹¤ ìë™ ì‹¤í–‰
# ============================================================
on:
  push:
    branches: [ main ]

# ============================================================
# ì „ì—­ í™˜ê²½ ë³€ìˆ˜
# - ëª¨ë“  job, stepì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥
# - Docker Hub ë¡œê·¸ì¸ ì •ë³´ëŠ” GitHub Secretsì—ì„œ ê°€ì ¸ì˜´
# ============================================================
env:
  DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}   # Docker Hub ID
  DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}   # Docker Hub PW

# ============================================================
# ì‹¤í–‰í•  Job ì •ì˜
# ============================================================
jobs:
  # -----------------------------
  # 1ï¸âƒ£ build job (CI ì—­í• )
  # -----------------------------
  build:
    # GitHubê°€ ì œê³µí•˜ëŠ” Ubuntu ëŸ¬ë„ˆì—ì„œ ì‹¤í–‰
    runs-on: ubuntu-latest

    steps:
    # --------------------------------------------------------
    # [1] GitHub ì €ì¥ì†Œ ì½”ë“œ ì²´í¬ì•„ì›ƒ
    # - runnerì— í˜„ì¬ repo ì†ŒìŠ¤ë¥¼ ë³µì‚¬
    # --------------------------------------------------------
    - uses: actions/checkout@v3

    # --------------------------------------------------------
    # [2] JDK 17 ì„¤ì¹˜
    # - Spring Boot ë¹Œë“œì— í•„ìš”
    # - temurin = Eclipse Temurin(OpenJDK)
    # --------------------------------------------------------
    - name: Setup JDK17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'

    # --------------------------------------------------------
    # [3] gradlew ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
    # - ë¦¬ëˆ…ìŠ¤ì—ì„œëŠ” ì‹¤í–‰ê¶Œí•œ ì—†ìœ¼ë©´ Permission denied ë°œìƒ
    # --------------------------------------------------------
    - name: gradlew íŒŒì¼ ì‹¤í–‰ ê¶Œí•œ ì„¤ì •
      run: chmod +x gradlew

    # --------------------------------------------------------
    # [4] Gradle í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    # - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰
    # - ì‹¤íŒ¨ ì‹œ ì—¬ê¸°ì„œ CI ì¤‘ë‹¨ë¨ (ì¤‘ìš”)
    # --------------------------------------------------------
    - name: Test with gradle
      run: sh gradlew --info test

    # --------------------------------------------------------
    # [5] Spring Boot ì‹¤í–‰ JAR ìƒì„±
    # - build/libs/*.jar ìƒì„±ë¨
    # - Dockerfileì—ì„œ ì´ JARì„ ì‚¬ìš©
    # --------------------------------------------------------
    - name: Spring boot ì‹¤í–‰ íŒŒì¼ ìƒì„±
      run: sh gradlew bootJar

    # --------------------------------------------------------
    # [6] Docker ì´ë¯¸ì§€ ë¹Œë“œ
    # - Dockerfile ê¸°ë°˜ìœ¼ë¡œ ì´ë¯¸ì§€ ìƒì„±
    # - íƒœê·¸: dockerhubID/devops_step2:v1.0
    # --------------------------------------------------------
    - name: docker image ìƒì„±
      run: docker build -t ${{ env.DOCKER_USERNAME }}/devops_step2:v1.0 .

    # --------------------------------------------------------
    # [7] Docker Hub ë¡œê·¸ì¸
    # - docker pushë¥¼ í•˜ê¸° ìœ„í•œ ì¸ì¦
    # --------------------------------------------------------
    - name: docker login
      uses: docker/login-action@v1
      with:
        username: ${{ env.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}

    # --------------------------------------------------------
    # [8] Docker Hubë¡œ ì´ë¯¸ì§€ Push
    # - CI ê²°ê³¼ë¬¼ì„ ì™¸ë¶€ ì €ì¥ì†Œì— ì €ì¥
    # --------------------------------------------------------
    - name: docker image í—ˆë¸Œì— ì €ì¥
      run: docker push ${{ env.DOCKER_USERNAME }}/devops_step2:v1.0

  # -----------------------------
  # 2ï¸âƒ£ deploy job (CD ì—­í• )
  # -----------------------------
  deploy:
    # build jobì´ ì„±ê³µí•´ì•¼ ì‹¤í–‰ë¨
    needs: build

    name: Deploy

    # self-hosted runner
    # ğŸ‘‰ ì‹¤ì œ ì„œë²„(EC2, VM, ì˜¨í”„ë ˆë¯¸ìŠ¤ ë“±)ì— ì„¤ì¹˜ëœ GitHub Runner
    runs-on: self-hosted

    steps:
    # --------------------------------------------------------
    # [1] ë°°í¬ ì„œë²„ì—ì„œ Docker Hub ë¡œê·¸ì¸
    # --------------------------------------------------------
    - name: docker login
      uses: docker/login-action@v1
      with:
        username: ${{ env.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}

    # -------------------------------
